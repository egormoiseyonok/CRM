# Микросервисная архитектура Simple CRM

Проект разделен на фронтенд (статический) и бэкенд (PHP), что позволяет:

- **Деплоить фронтенд на GitHub Pages** - для демонстрации интерфейса
- **Запускать локально с PHP** - для полной функциональности

## Структура проекта

```
CRM/
├── frontend/              # Статический фронтенд (для GitHub Pages)
│   ├── index.html
│   ├── login.html
│   ├── css/              # Стили
│   ├── js/               # JavaScript код
│   │   ├── config.js     # Автоопределение окружения
│   │   ├── api.js        # API клиент
│   │   ├── app.js        # Утилиты
│   │   └── layout.js      # Layout управление
│   └── README.md
├── api/                   # PHP API endpoints
│   ├── cors.php          # CORS настройки
│   ├── search.php
│   ├── company.php
│   ├── contact.php
│   ├── user.php
│   └── meeting.php
├── assets/                # CSS файлы (используются в frontend/)
├── config.php             # PHP конфигурация
├── *.php                  # PHP страницы (старая версия, для совместимости)
└── .htaccess              # Apache конфигурация
```

## Как это работает

### 1. На GitHub Pages (статический хостинг)

- Фронтенд работает как статический сайт
- JavaScript автоматически определяет, что бэкенд недоступен
- Показывается сообщение о необходимости локального запуска
- Интерфейс доступен для просмотра

### 2. Локально (с PHP бэкендом)

- Фронтенд автоматически определяет локальное окружение
- Все API запросы идут на `http://localhost/CRM/api/`
- Полная функциональность доступна:
  - Вход/регистрация
  - CRUD операции
  - Поиск
  - Все функции CRM

## Быстрый старт

### Локальный запуск (полная функциональность)

1. Установите XAMPP или другой PHP сервер
2. Склонируйте репозиторий в `htdocs/CRM`
3. Настройте PostgreSQL базу данных в `config.php`
4. Откройте `http://localhost/CRM/frontend/`
5. Фронтенд автоматически подключится к PHP API

### Деплой на GitHub Pages

1. Перейдите в Settings → Pages вашего репозитория
2. Выберите источник: папка `frontend/` или ветка `gh-pages`
3. Сохраните настройки
4. Через несколько минут фронтенд будет доступен на `https://username.github.io/repo/`

Подробные инструкции: см. `DEPLOYMENT_FRONTEND.md`

## Технические детали

### Автоопределение окружения

Файл `frontend/js/config.js` автоматически определяет окружение:

```javascript
// Если на GitHub Pages
if (window.location.hostname.includes('github.io')) {
    return null; // Бэкенд недоступен
}

// Иначе - локальное окружение
return window.location.origin; // http://localhost
```

### API клиент

Файл `frontend/js/api.js` предоставляет класс `ApiClient`:

```javascript
const api = new ApiClient();

// Примеры использования
await api.getCurrentUser();
await api.search('query');
await api.getCompany(1);
```

### CORS настройки

Файл `api/cors.php` настраивает CORS headers для поддержки запросов с фронтенда.

Все API endpoints включают этот файл:

```php
require_once __DIR__ . '/cors.php';
```

## Миграция со старой версии

Старые PHP страницы (`index.php`, `companies.php` и т.д.) остаются для обратной совместимости.

Новая архитектура:
- Фронтенд: `frontend/*.html` + `frontend/js/*.js`
- Бэкенд: `api/*.php`

Вы можете постепенно мигрировать, используя оба варианта параллельно.

## Преимущества новой архитектуры

1. **Разделение ответственности**: фронтенд и бэкенд разделены
2. **Гибкость деплоя**: фронтенд можно задеплоить отдельно
3. **Масштабируемость**: легко добавить другие фронтенды (React, Vue и т.д.)
4. **Совместимость**: старые PHP страницы продолжают работать

## Дальнейшее развитие

Возможные улучшения:

1. Добавить JWT токены вместо сессий для API
2. Создать полноценный REST API с документацией
3. Добавить поддержку других фронтенд фреймворков
4. Настроить CI/CD для автоматического деплоя

## Поддержка

Если возникли проблемы:

1. Проверьте консоль браузера (F12) на ошибки
2. Убедитесь, что PHP сервер запущен (для локального использования)
3. Проверьте настройки CORS в `api/cors.php`
4. Убедитесь, что пути к файлам корректны

